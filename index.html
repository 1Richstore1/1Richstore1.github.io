<!DOCTYPE html>
<html lang="ko" class="light">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Rich-Store ì„œë¹„ìŠ¤ í”Œë«í¼</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300 antialiased">
    <div id="root"></div>

    <script type="text/babel">
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë°ì´í„° ê´€ë¦¬ ìœ í‹¸ë¦¬í‹°
        const getLocalData = (key, defaultValue) => {
            try {
                const saved = localStorage.getItem(key);
                return saved ? JSON.parse(saved) : defaultValue;
            } catch (e) {
                console.error(`Error loading from localStorage for key "${key}":`, e);
                return defaultValue;
            }
        };

        const setLocalData = (key, value) => {
            try {
                localStorage.setItem(key, JSON.stringify(value));
            } catch (e) {
                console.error(`Error saving to localStorage for key "${key}":`, e);
            }
        };

        // ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»´í¬ë„ŒíŠ¸
        function App() {
            // ìƒíƒœ ê´€ë¦¬
            const [services, setServices] = React.useState(() => getLocalData("services", []));
            const [categories, setCategories] = React.useState(() => getLocalData("categories", []));
            const [search, setSearch] = React.useState("");
            const [filter, setFilter] = React.useState("all");
            const [isAdmin, setIsAdmin] = React.useState(false);
            const [loginModalOpen, setLoginModalOpen] = React.useState(false);
            const [selectedService, setSelectedService] = React.useState(null); // ìƒì„¸ ë³´ê¸° ì„œë¹„ìŠ¤
            const [editingService, setEditingService] = React.useState(null); // ìˆ˜ì •/ì¶”ê°€í•  ì„œë¹„ìŠ¤
            const [loginCode, setLoginCode] = React.useState(null);
            const [codeSentAt, setCodeSentAt] = React.useState(null);
            const [theme, setTheme] = React.useState(() => getLocalData("theme", "light"));
            const [webhookUrl, setWebhookUrl] = React.useState(() => getLocalData("webhookUrl", ""));

            // í…Œë§ˆ í† ê¸€ í•¨ìˆ˜
            const toggleTheme = () => {
                const newTheme = theme === 'light' ? 'dark' : 'light';
                setTheme(newTheme);
                document.documentElement.classList.remove(theme);
                document.documentElement.classList.add(newTheme);
            };

            // ì´ˆê¸° ë¡œë“œ ì‹œ í…Œë§ˆ ì ìš© ë° ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë™ê¸°í™”
            React.useEffect(() => {
                document.documentElement.classList.add(theme);
            }, [theme]);

            React.useEffect(() => {
                setLocalData("services", services);
            }, [services]);

            React.useEffect(() => {
                setLocalData("categories", categories);
            }, [categories]);

            React.useEffect(() => {
                setLocalData("theme", theme);
            }, [theme]);

            React.useEffect(() => {
                setLocalData("webhookUrl", webhookUrl);
            }, [webhookUrl]);

            // ê´€ë¦¬ì ë¡œê·¸ì¸ ê´€ë ¨ í•¨ìˆ˜
            const sendLoginCode = async () => {
                // ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì´ ì›¹í›… URLì„ ì ˆëŒ€ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì— ë…¸ì¶œí•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.
                // ì„œë²„ ì¸¡ì—ì„œ ì²˜ë¦¬í•˜ì—¬ ë³´ì•ˆì„ ê°•í™”í•´ì•¼ í•©ë‹ˆë‹¤.
                const LOGIN_WEBHOOK_URL = "https://discord.com/api/webhooks/1393456540899348551/rg9qYJfRf98VSX4LqK0swHGu3vOZ8m_Qe27ooubs4ypPkmHeXVFNCoTSPFOm11omHmR-";

                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
                const code = Array.from({ length: 16 }, () => chars[Math.floor(Math.random() * chars.length)]).join('');
                setLoginCode(code);
                setCodeSentAt(Date.now());

                try {
                    await fetch(LOGIN_WEBHOOK_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            content: `ğŸ” **[Rich-Store ë¡œê·¸ì¸ ì½”ë“œ]**\n1íšŒìš© ê´€ë¦¬ì ì½”ë“œ: \`${code}\`\nâ€» 3ë¶„ ì´ë‚´ì— ì…ë ¥í•˜ì„¸ìš”.`,
                        })
                    });
                    alert("âœ… ë””ìŠ¤ì½”ë“œë¡œ ë¡œê·¸ì¸ ì½”ë“œê°€ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
                } catch (error) {
                    alert("âŒ ë¡œê·¸ì¸ ì½”ë“œ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì›¹í›… URLì„ í™•ì¸í•˜ê±°ë‚˜ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                    console.error("Login webhook error:", error);
                }
            };

            const handleLogin = () => {
                const input = document.getElementById("otp")?.value.trim();
                if (!input) {
                    alert("ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
                    return;
                }
                if (!loginCode) {
                    alert("ë¨¼ì € ì½”ë“œ ìš”ì²­ì„ í•´ì£¼ì„¸ìš”.");
                    return;
                }
                if (Date.now() - codeSentAt > 3 * 60 * 1000) {
                    alert("â° ì½”ë“œê°€ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                    setLoginCode(null);
                    setCodeSentAt(null);
                    return;
                }

                if (input === loginCode) {
                    setIsAdmin(true);
                    setLoginModalOpen(false);
                    setLoginCode(null);
                    setCodeSentAt(null);
                    alert("âœ… ê´€ë¦¬ì ë¡œê·¸ì¸ ì™„ë£Œ");
                } else {
                    alert("âŒ ì½”ë“œê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                }
            };

            const handleLogout = () => {
                setIsAdmin(false);
                setLoginCode(null);
                setCodeSentAt(null);
                setLoginModalOpen(false);
                alert("âœ… ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.");
            };

            // ì¬ê³  ì—…ë°ì´íŠ¸ ì›¹í›… ì•Œë¦¼ (ì„ë² ë“œ í˜•ì‹ìœ¼ë¡œ ë³€ê²½ - 400 ì—ëŸ¬ ë°œìƒ ê°€ëŠ¥ì„± ì¤„ì´ê¸° ìœ„í•´ ë³´ì™„)
            const sendStockUpdateWebhook = async (service) => {
                if (!webhookUrl) {
                    console.warn("ì›¹í›… URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì¬ê³  ë³€ê²½ ì•Œë¦¼ì„ ë³´ë‚¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    alert("âŒ ì¬ê³  ì•Œë¦¼ ì›¹í›… URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê´€ë¦¬ì ì„¤ì •ì—ì„œ ì›¹í›… URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    return;
                }
                
                // ë””ë²„ê¹…ì„ ìœ„í•œ ë¡œê·¸ ì¶”ê°€
                console.log("--- ì›¹í›… ì „ì†¡ ì‹œë„ (ìˆ˜ì •ëœ í•¨ìˆ˜) ---");
                console.log("ëŒ€ìƒ ì›¹í›… URL:", webhookUrl);
                console.log("ì „ì†¡ë  ì„œë¹„ìŠ¤ ì •ë³´:", service); 

                // --- ìˆ˜ì •ëœ ë¶€ë¶„: êµ¬ë§¤ í˜ì´ì§€ ë§í¬ë¥¼ ë””ìŠ¤ì½”ë“œ ì±„ë„ URLë¡œ ë³€ê²½ ---
                // ì—¬ê¸°ì— ì‚¬ìš©ìê°€ ìš”ì²­í•œ íŠ¹ì • ë””ìŠ¤ì½”ë“œ ì±„ë„ URLì„ ì§ì ‘ ì§€ì •í•©ë‹ˆë‹¤.
                const buyNowLink = "https://discord.com/channels/1391819445584007299/1391819447026581582"; 
                // -----------------------------------------------------

                // ì„ë² ë“œ í•„ë“œ ë‚´ìš© ì •ë¦¬ ë° ê¸¸ì´ ì œí•œ ê³ ë ¤
                // ê° í•„ë“œì˜ í…ìŠ¤íŠ¸ ê¸¸ì´ë¥¼ ì´ˆê³¼í•˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì„¸ìš”.
                const embedTitle = `ğŸ“¦ ${service.title} ì¬ê³  ì…ê³ !`.substring(0, 256); // ìµœëŒ€ 256ì
                const embedDescription = `ì €í¬ ì œí’ˆ **[${service.title}]**ì˜ ì¬ê³ ê°€ ì…ê³ ë˜ì—ˆìŠµë‹ˆë‹¤!\n[ì§€ê¸ˆ êµ¬ë§¤í•˜ê¸°](${buyNowLink})`.substring(0, 4096); // ìµœëŒ€ 4096ì

                const priceValue = `${(service.price || 0).toLocaleString()}ì›`;
                const stockValue = `${(service.stock || 0)}ê°œ`;
                const categoryValue = service.category || "ê¸°íƒ€";

                const embed = {
                    title: embedTitle,
                    description: embedDescription,
                    color: 0x4CAF50, // ì´ˆë¡ìƒ‰ (RGB 76, 175, 80)
                    fields: [
                        {
                            name: "ê°€ê²©",
                            value: priceValue.substring(0, 1024), // ìµœëŒ€ 1024ì
                            inline: true
                        },
                        {
                            name: "í˜„ì¬ ì¬ê³ ",
                            value: stockValue.substring(0, 1024), // ìµœëŒ€ 1024ì
                            inline: true
                        },
                        {
                            name: "ì¹´í…Œê³ ë¦¬",
                            value: categoryValue.substring(0, 1024), // ìµœëŒ€ 1024ì
                            inline: true
                        }
                    ],
                    // imageì™€ thumbnail URLì€ ìœ íš¨í•˜ê³  ë””ìŠ¤ì½”ë“œê°€ ì ‘ê·¼ ê°€ëŠ¥í•œ ê³µê°œ URLì´ì–´ì•¼ í•©ë‹ˆë‹¤.
                    // ë§Œì•½ ì´ë¯¸ì§€ URLì´ ë¬¸ì œë¥¼ ì¼ìœ¼í‚¨ë‹¤ë©´ ì´ ë¶€ë¶„ì„ ì£¼ì„ ì²˜ë¦¬í•˜ê³  í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.
                    thumbnail: service.image && typeof service.image === 'string' && service.image.startsWith('http') ? { 
                         url: service.image
                    } : undefined, // ìœ íš¨í•œ URLì´ ì•„ë‹ˆë©´ ì¶”ê°€í•˜ì§€ ì•ŠìŒ
                    image: service.image && typeof service.image === 'string' && service.image.startsWith('http') ? { 
                        url: service.image
                    } : undefined, // ìœ íš¨í•œ URLì´ ì•„ë‹ˆë©´ ì¶”ê°€í•˜ì§€ ì•ŠìŒ
                    footer: {
                        text: "Rich-Store", 
                        // icon_url: "https://your-store-icon-url.com/icon.png" // ìƒì  ì•„ì´ì½˜ URL (ì„ íƒ ì‚¬í•­)
                    },
                    timestamp: new Date().toISOString()
                };

                // ìµœì¢… ì„ë² ë“œ ê°ì²´ë„ ë¡œê·¸ì— ì¶œë ¥í•˜ì—¬ í™•ì¸ (ë¬¸ì œ ë°œìƒ ì‹œ ì´ ë¡œê·¸ë¥¼ ë³µì‚¬í•˜ì—¬ ì›¹í›… í…ŒìŠ¤í„°ì—ì„œ ê²€ì¦)
                console.log("ì „ì†¡ë  ì„ë² ë“œ ê°ì²´ (ìµœì¢…):", embed);

                try {
                    const response = await fetch(webhookUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            embeds: [embed] 
                        })
                    });

                    if (response.ok) { // HTTP ìƒíƒœ ì½”ë“œê°€ 200-299 ë²”ìœ„ì¸ ê²½ìš°
                        console.log("âœ… ì¬ê³  ë³€ê²½ ì„ë² ë“œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ!");
                    } else {
                        // ì‹¤íŒ¨ ì‹œ ì‘ë‹µ ë³¸ë¬¸ì„ ì½ì–´ì„œ ë” ìì„¸í•œ ì •ë³´ ì¶œë ¥
                        const errorText = await response.text();
                        console.error(`âŒ ì›¹í›… ì•Œë¦¼ ì „ì†¡ ì‹¤íŒ¨! HTTP ìƒíƒœ ì½”ë“œ: ${response.status}, ì‘ë‹µ ë³¸ë¬¸: ${errorText}`);
                        alert(`âŒ ì¬ê³  ì•Œë¦¼ ì›¹í›… ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ìƒíƒœ: ${response.status}) Discord ì„¤ì • ë˜ëŠ” ì›¹í›… URLì„ í™•ì¸í•˜ì„¸ìš”. ìƒì„¸: ${errorText.substring(0, 100)}...`);
                    }
                } catch (error) {
                    console.error("âŒ ì›¹í›… ì•Œë¦¼ ì „ì†¡ ì¤‘ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë°œìƒ:", error);
                    alert("âŒ ì¬ê³  ì•Œë¦¼ ì›¹í›… ì „ì†¡ ì¤‘ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.");
                }
            };

            // ì„œë¹„ìŠ¤ ì¶”ê°€/ìˆ˜ì •
            const addOrUpdateService = (svc) => {
                setServices(prev => {
                    const existingService = prev.find(p => p.id === svc.id);
                    let updatedServices;
                    if (existingService) {
                        updatedServices = prev.map(p => p.id === svc.id ? svc : p);
                        // ì¬ê³  ë³€ê²½ì´ ìˆì„ ë•Œë§Œ ì›¹í›… ì•Œë¦¼
                        if (existingService.stock !== svc.stock) {
                            sendStockUpdateWebhook(svc); // ë³€ê²½ëœ ì„œë¹„ìŠ¤ ê°ì²´ ì „ì²´ë¥¼ ì „ë‹¬
                        }
                    } else {
                        updatedServices = [...prev, { ...svc, stock: Number(svc.stock) || 0 }]; // ì´ˆê¸° ì¬ê³  0ìœ¼ë¡œ ì„¤ì •, NaN ë°©ì§€
                        // ìƒˆ ì œí’ˆ ì¶”ê°€ ì‹œì—ë„ ì´ˆê¸° ì¬ê³  ì•Œë¦¼ (ì¬ê³ ê°€ 0ì´ ì•„ë‹ˆë©´ ì•Œë¦¼)
                        if (Number(svc.stock) > 0) {
                            sendStockUpdateWebhook({ ...svc, stock: Number(svc.stock) || 0 }); 
                        }
                    }
                    return updatedServices;
                });
            };

            // ì„œë¹„ìŠ¤ ì‚­ì œ
            const deleteService = id => {
                if (confirm("ì •ë§ ì´ ì„œë¹„ìŠ¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                    setServices(prev => prev.filter(s => s.id !== id));
                }
            };

            // ì„œë¹„ìŠ¤ ì¬ê³  ì—…ë°ì´íŠ¸
            const updateServiceStock = (id, stockChange) => {
                setServices(prev => prev.map(svc => {
                    if (svc.id === id) {
                        const oldStock = svc.stock;
                        // NaN ë°©ì§€ ë° ì¬ê³ ê°€ 0 ë¯¸ë§Œìœ¼ë¡œ ë‚´ë ¤ê°€ì§€ ì•Šë„ë¡ í•¨
                        const newStock = Math.max(0, Number(oldStock) + Number(stockChange)); 
                        const updatedSvc = { ...svc, stock: newStock }; 
                        if (oldStock !== updatedSvc.stock) { // ì¬ê³ ê°€ ì‹¤ì œë¡œ ë³€ê²½ë˜ì—ˆì„ ë•Œë§Œ ì›¹í›… ì „ì†¡
                            sendStockUpdateWebhook(updatedSvc); // ë³€ê²½ëœ ì„œë¹„ìŠ¤ ê°ì²´ ì „ì²´ë¥¼ ì „ë‹¬
                        }
                        return updatedSvc;
                    }
                    return svc;
                }));
            };

            // --- ì»´í¬ë„ŒíŠ¸ë“¤ ---

            // ì„œë¹„ìŠ¤ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
            const ServiceCard = ({ svc }) => (
                <div 
                    onClick={() => setSelectedService(svc)} 
                    className="relative cursor-pointer bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg hover:ring-2 hover:ring-blue-400 dark:hover:ring-blue-600 transition-all duration-200 overflow-hidden group"
                >
                    <img 
                        src={svc.image} 
                        alt={svc.title} 
                        className="h-48 w-full object-cover transition-transform duration-300 group-hover:scale-105" 
                        onError={(e) => { e.target.onerror = null; e.target.src="https://via.placeholder.com/400x300.png?text=No+Image"; }}
                    />
                    <div className="p-4">
                        <h3 className="text-xl font-semibold mb-1 truncate">{svc.title}</h3>
                        <p className="text-sm text-gray-600 dark:text-gray-300 line-clamp-2 mb-2">{svc.desc}</p>
                        <div className="flex justify-between items-baseline mt-3">
                            <div className="text-lg text-blue-600 dark:text-blue-400 font-bold">{svc.price.toLocaleString()}ì›</div>
                            {svc.stock !== undefined && (
                                <div className={`text-sm font-medium px-2 py-1 rounded-full ${svc.stock === 0 ? 'bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300' : 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300'}`}>
                                    ì¬ê³ : {svc.stock}ê°œ
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );

            // ì„œë¹„ìŠ¤ ìƒì„¸ ë³´ê¸° ì»´í¬ë„ŒíŠ¸
            const ServiceDetail = ({ svc, onBack }) => (
                <div className="max-w-4xl mx-auto p-4 animate-fade-in-up">
                    <button 
                        onClick={onBack} 
                        className="mb-6 text-blue-600 dark:text-blue-400 hover:underline text-base flex items-center gap-2 px-4 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
                    >
                        <i className="fas fa-arrow-left"></i> ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                    </button>
                    <div className="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-8 flex flex-col md:flex-row gap-8">
                        <img 
                            src={svc.image} 
                            alt={svc.title} 
                            className="w-full md:w-1/2 max-h-96 rounded-lg object-cover shadow-lg" 
                            onError={(e) => { e.target.onerror = null; e.target.src="https://via.placeholder.com/600x400.png?text=No+Image"; }}
                        />
                        <div className="flex-1 flex flex-col justify-between">
                            <div>
                                <h2 className="text-3xl md:text-4xl font-extrabold mb-3 text-gray-900 dark:text-gray-100">{svc.title}</h2>
                                <p className="text-gray-700 dark:text-gray-300 mb-6 text-base leading-relaxed whitespace-pre-wrap">{svc.desc}</p>
                            </div>
                            <div>
                                <div className="text-3xl text-blue-600 dark:text-blue-400 font-extrabold mb-3">{svc.price.toLocaleString()}ì›</div>
                                {svc.stock !== undefined && (
                                    <div className={`text-lg font-bold mb-6 ${svc.stock === 0 ? 'text-red-600 dark:text-red-500' : 'text-green-700 dark:text-green-500'}`}>
                                        í˜„ì¬ ì¬ê³ : {svc.stock}ê°œ
                                    </div>
                                )}
                                <button 
                                    className={`w-full py-4 rounded-xl text-xl font-bold transition-all duration-300 ${svc.stock === 0 ? 'bg-gray-400 dark:bg-gray-600 text-gray-700 dark:text-gray-300 cursor-not-allowed opacity-70' : 'bg-blue-600 text-white hover:bg-blue-700 active:scale-95'}`} 
                                    disabled={svc.stock === 0}
                                >
                                    {svc.stock === 0 ? "ì¬ê³  ì—†ìŒ" : "êµ¬ë§¤í•˜ê¸°"}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );

            // ì„œë¹„ìŠ¤ ì¶”ê°€/ìˆ˜ì • í¼ ì»´í¬ë„ŒíŠ¸
            const ServiceForm = ({ svc, onClose, onSubmit }) => {
                const [title, setTitle] = React.useState(svc?.title || "");
                const [desc, setDesc] = React.useState(svc?.desc || "");
                const [price, setPrice] = React.useState(svc?.price || "");
                const [image, setImage] = React.useState(svc?.image || "");
                const [category, setCategory] = React.useState(svc?.category || categories[0] || "");
                const [stock, setStock] = React.useState(svc?.stock !== undefined ? svc.stock : 0);

                const handleSubmit = (e) => {
                    e.preventDefault();
                    onSubmit({ 
                        id: svc?.id || Date.now(), 
                        title, 
                        desc, 
                        price: Number(price), 
                        image, 
                        category, 
                        stock: Number(stock) // NaN ë°©ì§€
                    });
                    onClose();
                };

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4 backdrop-blur-sm animate-fade-in">
                        <form onSubmit={handleSubmit} className="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-lg transform animate-scale-in">
                            <h2 className="text-2xl font-bold mb-6 text-center text-blue-600 dark:text-blue-400">{svc ? "ì„œë¹„ìŠ¤ ìˆ˜ì •" : "ìƒˆ ì„œë¹„ìŠ¤ ì¶”ê°€"}</h2>
                            <div className="space-y-4">
                                <input value={title} onChange={e => setTitle(e.target.value)} placeholder="ì„œë¹„ìŠ¤ ì œëª©" className="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:ring-blue-500 focus:border-blue-500 transition-colors" required/>
                                <textarea value={desc} onChange={e => setDesc(e.target.value)} placeholder="ì„œë¹„ìŠ¤ ì„¤ëª…" className="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg h-32 bg-transparent focus:ring-blue-500 focus:border-blue-500 resize-none transition-colors" required />
                                <input value={price} type="number" onChange={e => setPrice(e.target.value)} placeholder="ê°€ê²©" className="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:ring-blue-500 focus:border-blue-500 transition-colors" required/>
                                <input value={image} onChange={e => setImage(e.target.value)} placeholder="ì´ë¯¸ì§€ URL" className="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:ring-blue-500 focus:border-blue-500 transition-colors" required/>
                                <input value={stock} type="number" onChange={e => setStock(e.target.value)} placeholder="ì¬ê³  ìˆ˜ëŸ‰" className="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:ring-blue-500 focus:border-blue-500 transition-colors" required/>
                                <select value={category} onChange={e => setCategory(e.target.value)} className="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:ring-blue-500 focus:border-blue-500 transition-colors" required>
                                    {categories.length > 0 ? (
                                        categories.map(cat => <option key={cat} value={cat}>{cat}</option>)
                                    ) : (
                                        <option value="" disabled>ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤</option>
                                    )}
                                </select>
                            </div>
                            <div className="flex justify-end gap-3 mt-6">
                                <button type="button" onClick={onClose} className="px-6 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors font-medium">ì·¨ì†Œ</button>
                                <button type="submit" className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold">ì €ì¥</button>
                            </div>
                        </form>
                    </div>
                );
            };

            // ê´€ë¦¬ì íŒ¨ë„ ì»´í¬ë„ŒíŠ¸
            const AdminPanel = () => {
                const [newCategory, setNewCategory] = React.useState("");

                return (
                    <div className="mb-10 p-8 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 animate-fade-in-down">
                        <h3 className="text-2xl font-bold mb-8 text-center text-blue-600 dark:text-blue-400">
                            <i className="fas fa-user-cog mr-2"></i> ê´€ë¦¬ì ì„¤ì •
                        </h3>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6">
                            {/* í…Œë§ˆ ì„¤ì • */}
                            <div className="border border-gray-200 dark:border-gray-700 rounded-lg p-6 bg-gray-50 dark:bg-gray-700 shadow-sm">
                                <h4 className="text-xl font-semibold mb-4 flex items-center gap-2 text-gray-800 dark:text-gray-200">
                                    <i className="fas fa-palette text-blue-500"></i> í…Œë§ˆ ì„¤ì •
                                </h4>
                                <button 
                                    onClick={toggleTheme} 
                                    className="w-full px-5 py-3 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-100 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-700 transition-colors text-lg font-medium shadow-md"
                                >
                                    {theme === 'light' ? 'ğŸŒ™ ë‹¤í¬ ëª¨ë“œ ì „í™˜' : 'â˜€ï¸ ë¼ì´íŠ¸ ëª¨ë“œ ì „í™˜'}
                                </button>
                            </div>

                            {/* ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ */}
                            <div className="border border-gray-200 dark:border-gray-700 rounded-lg p-6 bg-gray-50 dark:bg-gray-700 shadow-sm">
                                <h4 className="text-xl font-semibold mb-4 flex items-center gap-2 text-gray-800 dark:text-gray-200">
                                    <i className="fas fa-tags text-green-500"></i> ì¹´í…Œê³ ë¦¬ ê´€ë¦¬
                                </h4>
                                <div className="flex flex-wrap gap-2 mb-4 max-h-24 overflow-y-auto pr-2">
                                    {categories.map(cat => (
                                        <div key={cat} className="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-3 py-1 rounded-full flex items-center text-sm font-medium shadow-sm">
                                            {cat}
                                            <button 
                                                onClick={() => setCategories(categories.filter(c => c !== cat))} 
                                                className="ml-2 text-blue-600 dark:text-blue-300 hover:text-red-500 dark:hover:text-red-400 transition-colors"
                                                title="ì¹´í…Œê³ ë¦¬ ì‚­ì œ"
                                            >
                                                <i className="fas fa-times-circle"></i>
                                            </button>
                                        </div>
                                    ))}
                                </div>
                                <div className="flex gap-2">
                                    <input 
                                        value={newCategory} 
                                        onChange={e => setNewCategory(e.target.value)} 
                                        className="p-3 border border-gray-300 dark:border-gray-600 rounded-lg flex-grow bg-transparent focus:ring-blue-500 focus:border-blue-500 transition-colors" 
                                        placeholder="ìƒˆ ì¹´í…Œê³ ë¦¬ëª… ì…ë ¥"
                                    />
                                    <button 
                                        onClick={() => { if (newCategory && !categories.includes(newCategory)) { setCategories([...categories, newCategory]); setNewCategory(""); }}} 
                                        className="bg-green-500 text-white px-5 py-2 rounded-lg hover:bg-green-600 transition-colors font-semibold shadow-md"
                                    >
                                        <i className="fas fa-plus-circle mr-1"></i> ì¶”ê°€
                                    </button>
                                </div>
                            </div>

                            {/* ë””ìŠ¤ì½”ë“œ ì›¹í›… ì„¤ì • */}
                            <div className="border border-gray-200 dark:border-gray-700 rounded-lg p-6 bg-gray-50 dark:bg-gray-700 shadow-sm col-span-full">
                                <h4 className="text-xl font-semibold mb-4 flex items-center gap-2 text-gray-800 dark:text-gray-200">
                                    <i className="fab fa-discord text-purple-500"></i> ë””ìŠ¤ì½”ë“œ ì¬ê³  ì•Œë¦¼ ì›¹í›… ì„¤ì •
                                </h4>
                                <input
                                    value={webhookUrl}
                                    onChange={e => setWebhookUrl(e.target.value)}
                                    placeholder="ë””ìŠ¤ì½”ë“œ ì›¹í›… URL ì…ë ¥ (ì˜ˆ: https://discord.com/api/webhooks/...)"
                                    className="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                />
                                <p className="text-sm text-red-500 dark:text-red-400 mt-3 flex items-center gap-2 font-medium">
                                    <i className="fas fa-exclamation-triangle"></i> ê²½ê³ : ì›¹í›… URLì€ ì™¸ë¶€ì— ë…¸ì¶œë˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì„¸ìš”!
                                </p>
                            </div>

                            {/* ì œí’ˆë³„ ì¬ê³  ê´€ë¦¬ */}
                            <div className="border border-gray-200 dark:border-gray-700 rounded-lg p-6 bg-gray-50 dark:bg-gray-700 shadow-sm col-span-full">
                                <h4 className="text-xl font-semibold mb-4 flex items-center gap-2 text-gray-800 dark:text-gray-200">
                                    <i className="fas fa-warehouse text-orange-500"></i> ì œí’ˆë³„ ì¬ê³  ê´€ë¦¬
                                </h4>
                                <div className="space-y-3 max-h-80 overflow-y-auto pr-2">
                                    {services.length > 0 ? (
                                        services.map(svc => (
                                            <div key={svc.id} className="flex items-center justify-between bg-white dark:bg-gray-800 p-4 rounded-md shadow-sm">
                                                <span className="font-medium text-gray-800 dark:text-gray-200 flex-grow mr-4 truncate">{svc.title}</span>
                                                <div className="flex items-center gap-2">
                                                    <button 
                                                        onClick={() => updateServiceStock(svc.id, -1)} 
                                                        className="w-9 h-9 flex items-center justify-center bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors text-2xl font-bold leading-none active:scale-90"
                                                        title="ì¬ê³  ê°ì†Œ"
                                                    >
                                                        -
                                                    </button>
                                                    <span className="font-bold min-w-[40px] text-center text-xl text-gray-900 dark:text-gray-100">{svc.stock}</span>
                                                    <button 
                                                        onClick={() => updateServiceStock(svc.id, 1)} 
                                                        className="w-9 h-9 flex items-center justify-center bg-green-500 text-white rounded-full hover:bg-green-600 transition-colors text-2xl font-bold leading-none active:scale-90"
                                                        title="ì¬ê³  ì¦ê°€"
                                                    >
                                                        +
                                                    </button>
                                                </div>
                                            </div>
                                        ))
                                    ) : (
                                        <p className="text-center text-gray-500 dark:text-gray-400 py-4">ë“±ë¡ëœ ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // í•„í„°ë§ëœ ì„œë¹„ìŠ¤ ëª©ë¡
            const filteredServices = services.filter(s =>
                (s.title + s.desc).toLowerCase().includes(search.toLowerCase()) &&
                (filter === "all" || s.category === filter)
            );

            return (
                <div className="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
                    {/* í—¤ë” */}
                    <header className="flex flex-col sm:flex-row justify-between items-center mb-10 pb-5 border-b border-gray-200 dark:border-gray-700">
                        <h1 className="text-4xl font-extrabold text-blue-600 dark:text-blue-400 mb-4 sm:mb-0">
                            <i className="fas fa-store-alt mr-3"></i> Rich-Store ì„œë¹„ìŠ¤ í”Œë«í¼
                        </h1>
                        <div className="flex gap-3 items-center">
                            <button
                                onClick={isAdmin ? handleLogout : () => setLoginModalOpen(true)}
                                className="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-base font-semibold shadow-md active:scale-95"
                            >
                                {isAdmin ? "ë¡œê·¸ì•„ì›ƒ" : "ê´€ë¦¬ì ë¡œê·¸ì¸"}
                            </button>
                        </div>
                    </header>

                    {/* ì„œë¹„ìŠ¤ ìƒì„¸ ë³´ê¸° ë˜ëŠ” ë©”ì¸ í™”ë©´ */}
                    {selectedService ? (
                        <ServiceDetail svc={selectedService} onBack={() => setSelectedService(null)} />
                    ) : (
                        <>
                            {isAdmin && <AdminPanel />} {/* ê´€ë¦¬ì ë¡œê·¸ì¸ ì‹œì—ë§Œ ê´€ë¦¬ì íŒ¨ë„ í‘œì‹œ */}

                            {/* ê²€ìƒ‰ ë° í•„í„° ì˜ì—­ */}
                            <div className="flex flex-col md:flex-row gap-4 mb-8">
                                <div className="relative flex-grow">
                                    <i className="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-500"></i>
                                    <input
                                        placeholder="ì„œë¹„ìŠ¤ ê²€ìƒ‰..."
                                        value={search}
                                        onChange={e => setSearch(e.target.value)}
                                        className="w-full p-3 pl-12 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-blue-500 focus:border-blue-500 shadow-sm transition-colors"
                                    />
                                </div>
                                <select
                                    value={filter}
                                    onChange={e => setFilter(e.target.value)}
                                    className="w-full md:w-auto p-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-blue-500 focus:border-blue-500 shadow-sm transition-colors"
                                >
                                    <option value="all">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                                    {categories.map(c => <option key={c} value={c}>{c}</option>)}
                                </select>
                            </div>

                            {/* ìƒˆ ì„œë¹„ìŠ¤ ì¶”ê°€ ë²„íŠ¼ */}
                            {isAdmin && (
                                <button 
                                    onClick={() => setEditingService({})} 
                                    className="mb-8 bg-green-600 text-white px-7 py-3 rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 text-lg font-semibold shadow-md active:scale-95"
                                >
                                    <i className="fas fa-plus-square"></i> ìƒˆ ì„œë¹„ìŠ¤ ì¶”ê°€
                                </button>
                            )}

                            {/* ì„œë¹„ìŠ¤ ëª©ë¡ */}
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-7">
                                {filteredServices.map(svc => (
                                    <div key={svc.id} className="relative group">
                                        <ServiceCard svc={svc} />
                                        {isAdmin && (
                                            <div className="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                                                <button 
                                                    onClick={(e) => { e.stopPropagation(); setEditingService(svc); }} 
                                                    className="p-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors text-base w-9 h-9 flex items-center justify-center shadow-lg active:scale-90" 
                                                    title="ìˆ˜ì •"
                                                >
                                                    <i className="fas fa-edit"></i>
                                                </button>
                                                <button 
                                                    onClick={(e) => { e.stopPropagation(); deleteService(svc.id); }} 
                                                    className="p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors text-base w-9 h-9 flex items-center justify-center shadow-lg active:scale-90" 
                                                    title="ì‚­ì œ"
                                                >
                                                    <i className="fas fa-trash-alt"></i>
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                ))}
                                {filteredServices.length === 0 && (
                                    <p className="text-center text-gray-500 dark:text-gray-400 col-span-full py-12 text-lg">
                                        <i className="fas fa-info-circle mr-2"></i> ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ê±°ë‚˜ ë“±ë¡ëœ ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.
                                    </p>
                                )}
                            </div>
                        </>
                    )}

                    {/* ì„œë¹„ìŠ¤ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ */}
                    {editingService && (
                        <ServiceForm 
                            svc={editingService} 
                            onClose={() => setEditingService(null)} 
                            onSubmit={addOrUpdateService} 
                        />
                    )}

                    {/* ê´€ë¦¬ì ë¡œê·¸ì¸ ëª¨ë‹¬ */}
                    {loginModalOpen && (
                        <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4 backdrop-blur-sm animate-fade-in">
                            <div className="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-md transform animate-scale-in">
                                <h2 className="text-2xl font-bold mb-6 text-center text-blue-600 dark:text-blue-400">
                                    <i className="fas fa-sign-in-alt mr-2"></i> ê´€ë¦¬ì ë¡œê·¸ì¸
                                </h2>
                                {!loginCode ? (
                                    <button 
                                        onClick={sendLoginCode} 
                                        className="w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-lg font-semibold flex items-center justify-center gap-2 shadow-md active:scale-95"
                                    >
                                        <i className="fab fa-discord"></i> ë””ìŠ¤ì½”ë“œë¡œ ì½”ë“œ ë°›ê¸°
                                    </button>
                                ) : (
                                    <>
                                        <p className="text-sm text-gray-600 dark:text-gray-300 mb-4 text-center">ì „ì†¡ëœ 16ìë¦¬ ì½”ë“œë¥¼ 3ë¶„ ì´ë‚´ì— ì…ë ¥í•˜ì„¸ìš”.</p>
                                        <input 
                                            id="otp" 
                                            type="text" 
                                            placeholder="ë¡œê·¸ì¸ ì½”ë“œ ì…ë ¥" 
                                            className="w-full p-3 mb-5 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent text-center tracking-widest text-lg focus:ring-blue-500 focus:border-blue-500 transition-colors" 
                                            maxLength="16" 
                                        />
                                        <div className="flex justify-end gap-3">
                                            <button 
                                                onClick={() => { setLoginModalOpen(false); setLoginCode(null); setCodeSentAt(null); }} 
                                                className="px-6 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors font-medium"
                                            >ì·¨ì†Œ</button>
                                            <button 
                                                onClick={handleLogin} 
                                                className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold"
                                            >ë¡œê·¸ì¸</button>
                                        </div>
                                    </>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // React ì•± ë Œë”ë§
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
    <style>
        /* ê¸°ë³¸ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        .animate-scale-in { animation: scaleIn 0.3s ease-out forwards; }
        .animate-fade-in-up { animation: fadeInUp 0.4s ease-out forwards; }
        .animate-fade-in-down { animation: fadeInDown 0.4s ease-out forwards; }
    </style>
</body>
</html>
